services:
  litellm:
    image: ghcr.io/berriai/litellm:main-latest
    container_name: litellm
    depends_on:
      - ollama
      - pgvector
    restart: always
    networks:
      - proxy
    volumes:
      - ${DATA_DIR}/llm_stack/lite_llm.yml:/app/config.yml
    environment:
      - DATA_DIR=${DATA_DIR}
      - LITELLM_HOST=0.0.0.0
      - LITELLM_SALT_KEY=${LITELLM_SALT_KEY}
      - LITELLM_MASTER_KEY=${LITELLM_MASTER_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - DATABASE_URL=postgresql://litellm:${POSTGRES_PASSWORD}@pgvector:5432/litellm
    command:
      - "--config"
      - "/app/config.yml"
      - "--port"
      - "4000"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.litellm.entrypoints=websecure"
      - "traefik.http.routers.litellm.rule=Host(`litellm.${TRAEFIK_ACME_DOMAIN}`)"
      - "traefik.http.routers.litellm.tls.certresolver=cloudflare"
      - "traefik.http.services.litellm.loadbalancer.server.port=4000"
